---
layout: post
title: LangChain å­¦ä¹ 
date: 2023-03-25
categories: æŠ€æœ¯ 
tags: LangChain LLM
---
> è®© LLM(Large Language Model) è°ƒç”¨å¤–éƒ¨å·¥å…·å½¢æˆæ›´å¼ºå¤§çš„åº”ç”¨ï¼Œè¿™åœ¨æœ€è¿‘æˆäº†ä¸€ä¸ªè¶‹åŠ¿ã€‚
ä» LaMDA, ToolFormer åˆ° Visual ChatGPT å†åˆ°å¼•è½°åŠ¨çš„ ChatGPT plugins, æˆ‘ä»¬çœ‹åˆ°äº†è¿™ä¸ªæ–¹å‘çš„ä»·å€¼å’Œç©ºé—´ã€‚

æœ€è¿‘è‡ªå·±ä¹Ÿåœ¨æƒ³å¦‚ä½•ç”¨ LLMs æ¥é©±åŠ¨å·²æœ‰çš„å·¥å…·ï¼Œä½†æ²¡æœ‰æƒ³å¥½ä¸€ä¸ªå¦¥å–„çš„å®ç°æ–¹å¼ã€‚
åŸºäºæ­¤ï¼Œæˆ‘å…ˆè°ƒç ”äº†ä¸‹ Visual ChatGPT, å‘ç°å…¶ä½¿ç”¨äº† LangChain è¿™ä¸ªå·¥å…·ã€‚
LangChain æœ‰å¼€æºä»£ç ä¸”ç‹¬ç«‹äº LLMsï¼Œ è¯»äº† README, æ„Ÿè§‰å®ƒå¾ˆç¬¦åˆè‡ªå·±çš„æœŸæœ›å•Šã€‚é‚£å°±æ·±åº¦ä¼˜å…ˆï¼Œå…ˆæ¥å­¦ä¹ ä¸‹è¿™ä¸ªå·¥å…·å§ã€‚

## README: ä»€ä¹ˆæ˜¯ LangChain

*âš¡ Building applications with LLMs through composability âš¡*ï¼Œ
ä» LangChain [ä»£ç åº“][_repo]çš„è¿™å¥ç®€ä»‹ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿäº†è§£åˆ°å®ƒæ˜¯åšä»€ä¹ˆçš„ï¼š

- æ˜¯ä¸€ä¸ªåš LLMs ç›¸å…³åº”ç”¨çš„å¼€å‘å·¥å…·
- ä¸»è¦é€šè¿‡ç»„åˆ LLMs å’Œå…¶ä»–å·¥å…·æ¥å®ç°

å›è¿‡å¤´çœ‹ LangChain çš„ Logo: ğŸ¦œï¸ğŸ”—. è¿™æ˜¯ä¸¤ä¸ª emoji å­—ç¬¦ã€‚
ç¬¬ä¸€ä¸ªå½©è‰²é¸Ÿï¼ŒæŸ¥äº†ä¸‹æ˜¯[é¹¦é¹‰(parrot)][_parrot]ï¼Œ
å¯¹åº”åˆ° *Lang(uage)*, åº”è¯¥æ˜¯å–é¹¦é¹‰å¯ä»¥è¯´è¯è¿™ä¸ªç‚¹ï¼Œçªå‡ºè¿™ä¸ªå·¥å…·ä»¥è‡ªç„¶è¯­è¨€ä½œä¸ºäº¤äº’å…¥å£ï¼›
ç¬¬äºŒä¸ªå­—ç¬¦æ˜¯é”é“¾, å¯¹åº”åˆ° *Chain*, ç›´è§‚è¡¨è¾¾äº†ç»„åˆä¸²è”çš„æ€æƒ³ã€‚
è¿™ä¸ªå·¥å…·çš„åå­—å’Œ logoï¼Œè¿˜æ˜¯æŒºæ¸…æ™°ç®€æ´çš„ï¼Œå®Œç¾ä½“ç°äº†äººç±»çš„æ™ºæ…§ï¼ˆä¸ä¼šæ˜¯æœºå™¨å–çš„å§233ï¼‰ã€‚

åœ¨ README é‡Œï¼Œä½œè€…è¯´ LLMs è¿™ç§å˜é©æ€§çš„æŠ€æœ¯è®©å¼€å‘è€…å¯ä»¥åˆ›é€ ä»¥å‰ä¸å¯å®ç°çš„åº”ç”¨ï¼Œä½†æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¯­è¨€æ¨¡å‹ï¼Œè¿˜æ˜¯åŠ›æœ‰ä¸é€®ï¼Œ
ç»™å®ƒåŠ ç‚¹å…¶ä»–æ¥æºçš„è®¡ç®—å’ŒçŸ¥è¯†ï¼Œæ‰èƒ½å®ç°çœŸæ­£çš„å¼ºå¤§ã€‚
LangChain åŸºäºæ­¤åŠ¨æœºï¼Œç€åŠ›äºå¼€å‘å‡ºä¸€å¥—å·¥å…·æ¥è®© LLMs åˆ©ç”¨å¤–éƒ¨èƒ½åŠ›ã€‚è€Œä¸”ï¼Œè¿™ä¸æ˜¯æ„æƒ³ï¼Œå…¶å·²ç»å›´ç»•å‡ ä¸ªè½åœ°ç‚¹åšå‡ºäº†ä¸€äº›ç¤ºä¾‹ï¼š

1. åœ¨ç‰¹å®šæ–‡æ¡£ä¸Šåšé—®ç­”, ä¾‹å­æ˜¯ [Notion-QA][_notion_qa]
2. èŠå¤©æœºå™¨äººï¼Œç¤ºä¾‹ä¸º [ChatLangChain][_chat_langchain]
3. ä»£ç†å·¥å…·(Agent)ï¼Œ Example æ˜¯ [GPT+WolframAlpha](_gpt_wolframalpha). 
   [WolframAlpha][_wolfram] æ˜¯ä¸€ä¸ªåœ¨çº¿é—®ç­”ç³»ç»Ÿï¼Œè¿™ä¸ªä¾‹å­éƒ¨ç½²åœ¨ Huggingface ä¸Šã€‚

æ„Ÿè§‰è¿™å—åšå¾—è¿˜æŒºå¤§çš„ï¼Œä¸è¿‡ç›®å‰ LangChain ç›¸å…³é¡¹ç›®è¿˜æ˜¯æŒ‚åœ¨ hwchase17 è¿™ä¸ªä¸ªäººè´¦æˆ·ä¸‹çš„ï¼Œå‰å®³å•Šï¼

ä»åŠŸèƒ½ç‚¹çš„è§’åº¦çœ‹ï¼Œ LangChain çš„èƒ½åŠ›å¯ä»¥è½åˆ° 6 ä¸ªç‚¹ä¸Šï¼Œç”±ç®€å•åˆ°å¤æ‚ï¼Œä¾æ¬¡ä¸ºï¼š

1. LLMs å’Œ Prompts: åŒ…æ‹¬å¯¹æ‰€æœ‰ LLMs çš„é€šç”¨æ¥å£å°è£…ï¼Œä¸€äº›è°ƒç”¨ LLMs çš„å…¬å…±èƒ½åŠ›ï¼›å¯¹ Prompts çš„ç®¡ç†ã€ä¼˜åŒ–èƒ½åŠ›
2. Chains: å…·å¤‡å°† LLMs å’Œå…¶ä»–å·¥å…·ä¸²è”çš„èƒ½åŠ›ï¼›å¯¹ chains æä¾›äº†æ ‡å‡†æ¥å£ï¼Œæä¾›äº†ä¸€äº›å’Œå…¶ä»–å·¥å…·ç»“åˆçš„ä¸­é—´å±‚ï¼Œ
è¿˜å¯¹å¸¸ç”¨åº”ç”¨é¢„åˆ¶äº†ç«¯åˆ°ç«¯çš„chains.
3. åŸºäºç‰¹å®šæ•°æ®çš„ç”Ÿæˆ(Data Argumented Generation): æ„å»ºäº†ä¸€ä¸ªç‰¹å®šçš„ chain, å…ˆä»ç›®æ ‡æ•°æ®æºé‡Œæ‰¾æ•°æ®ï¼Œ
å†ç»™ LLMs åšç”Ÿæˆã€‚æ¯”å¦‚æŒ‡å®šé•¿æ–‡æ‘˜è¦ã€ç‰¹å®šæ•°æ®ä¸‹çš„é—®ç­”ã€‚
   > æˆ‘ä»¬çœ‹åˆ°ç›®å‰å¾ˆå¤šäº§å“éƒ½æ˜¯è¿™ä¸ªé“¾è·¯ã€‚æ¯”å¦‚ Paper é—®ç­”ï¼Œç”šè‡³ new bing.
4. Agents: æ‰€è°“ Agentï¼Œ å°±æ˜¯è®© LLMs ä½œä¸ºä»£ç†ï¼Œå†³å®šç°åœ¨è¦åšä»€ä¹ˆæ“ä½œã€æ‰§è¡Œæ“ä½œã€å¯¹æ“ä½œç»“æœåšè§£æå¹¶åŸºäºæ­¤ç»“æœåšåç»­æ“ä½œã€‚

   Agent æœ‰å¾ˆå¤šç§ï¼ˆé¢å‘ä¸åŒåœºæ™¯ï¼Œä»åé¢çš„æ–‡æ¡£å¯çŸ¥ï¼Œæœ‰é€šç”¨é—®ç­”åœºæ™¯ã€æ•°å­¦è®¡ç®—åœºæ™¯ç­‰ï¼‰ï¼Œ
   LangChain å®šä¹‰äº†æ ‡å‡†çš„ agent æ¥å£ï¼Œå¹¶æä¾›äº†ä¸€äº›æ ‡å‡† agent ä¾›é€‰æ‹©ï¼Œè¿˜æœ‰ä¸€äº›ç«¯åˆ°ç«¯çš„ agent çš„ä¾‹å­ã€‚
5. Memory: ç”¨æ¥åœ¨ä¸€ç³»åˆ— chains/agents è°ƒç”¨ä¸­ä¿å­˜çŠ¶æ€çš„ã€‚
   LangChain æä¾›äº† memory çš„æ ‡å‡†æ¥å£ï¼Œä¸€ç³»åˆ— memory çš„å®ç°å’Œ chains/agents ä½¿ç”¨ memory çš„ä¾‹å­ã€‚
6. è¯„ä¼°ï¼š ç”Ÿæˆå¼æ¨¡å‹å¾ˆéš¾åšæ•ˆæœè¯„ä¼°ï¼Œä¸€ç§æ–°çš„è¯„ä¼°æ–¹æ³•æ˜¯ç”¨ä»–ä»¬è‡ªå·±å»è¯„ä¼°è‡ªå·±ã€‚
LangChain æä¾›äº†ä¸€äº› prompts/chains æ¥è¾…åŠ©åšè¿™ä¸ªäº‹æƒ…ã€‚

## å¿«é€Ÿå¼€å§‹

åœ¨ [QuickStart guide][_quickstart] æ–‡æ¡£é‡Œï¼Œåˆ—ä¸¾äº†å¿«é€Ÿä¸Šæ‰‹çš„ä¾‹å­ï¼Œè¿™äº›ä¾‹å­å’Œä¸Šé¢æåˆ°çš„åŠŸèƒ½ç‚¹æ˜¯åŸºæœ¬å¯¹åº”çš„ã€‚

### åŸºç¡€å…ƒç´ ï¼š LLMs, Prompts

1. LLMs: æ„å»ºä¸€ä¸ª LLM çš„å®ä¾‹å¹¶è·å–å…¶è¿”å›ç»“æœã€‚è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯å·²æœ‰ API çš„å°è£…ã€‚
   ä½†è¿™ä¸ªå®ä¾‹æ˜¯åç»­æ­¥éª¤çš„åŸºç¡€(è¢«ç§°ä¸ºæ˜¯ *one primitive*)ã€‚

2. Prompts æ¨¡æ¿ï¼šå®ç°äº†ä¸€ä¸ªæç¤ºæ¨¡æ¿ç±»ã€‚ä¼¼ä¹å°±æ˜¯ `Python str.format` çš„ä¸€ä¸ªå°è£…ï¼Œä½†è¿™åŒæ ·æ˜¯åŸºç¡€æ¨¡å—ã€‚

### ä¸²è”: Chains

ç»™çš„ä¾‹å­æ˜¯é¢„å…ˆå®šä¹‰çš„ `LLMChain`ï¼š
   
ç”¨ `chain = LLMChain(llm=llm, prompt=prompt)` å®ä¾‹åŒ–åï¼Œ
ç›´æ¥`chain(prompt_input_var)` è°ƒç”¨å°±å¯ä»¥å®Œæˆ 1. æç¤ºæ¨¡æ¿å¡«å…… 2. è¯·æ±‚ LLM å¹¶è¿”å› è¿™ä¸ªä¸¤ä¸ªæ­¥éª¤ã€‚

çœ‹åˆ°è¿™é‡Œè§‰å¾—è¿˜ OKï¼Œ åªæ˜¯å·¥ç¨‹ä¸Šçš„å°è£…ï¼Œè¿˜æ²¡æœ‰ä½“ç°å‡º LLMs é©±åŠ¨å·¥å…·çš„åŠŸèƒ½ï¼›
ä¸è¿‡ Chain è¿™ä¸ªç‚¹å·²ç»çœ‹å‡ºæ¥äº†â€”â€”æ˜¯è¦é€šè¿‡å®šä¹‰ç±»æ¥å®ç°çš„ã€‚

### åŸºäºç”¨æˆ·è¾“å…¥è‡ªåŠ¨è°ƒåº¦ï¼š Agents

å‰é¢è¯´åˆ°ï¼ŒAgent å°±æ˜¯åœ¨æ¥å—åˆ°ç”¨æˆ·çš„è¾“å…¥åï¼Œè®© LLMs æ¥å†³å®šè¦æ‰§è¡Œä»€ä¹ˆæ“ä½œã€ä»¥ä»€ä¹ˆé¡ºåºæ¥æ‰§è¡Œã€‚
è¿™æ˜¯ LLMs ä½“ç° AGI(Artificial General Intelligence, å¼ºäººå·¥æ™ºèƒ½) èƒ½åŠ›çš„é‡è¦ç‰¹å¾ã€‚

LangChain åœ¨å®ç°è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œä½¿ç”¨äº† 3 ä¸ªæ¦‚å¿µï¼ˆæŠ½è±¡/æ¨¡å—ï¼‰ï¼š

1. Tool: å®ç°ç‰¹å®šèŒè´£çš„å‡½æ•°ï¼Œæ˜¯è°ƒåº¦çš„æœ€å°å•å…ƒã€‚
å·¥å…·å¯ä»¥æ˜¯ *Google Search*, *Python REPL(Read-Eval-Print-Loop)* ç­‰åŸºç¡€å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª chain.
   éœ€è¦å®ç°ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç›®å‰è¿™ä¸ªæ¥å£æ˜¯ `(input: str) -> str`. 
   
2. LLM: Agent çš„æ ¸å¿ƒèƒ½åŠ›.
3. Agent: Agents çš„å…·ä½“å®ä½“ï¼Œåœ¨ Tools å’Œ LLM ä¹‹ä¸Šæ„å»ºçš„è°ƒåº¦å™¨ã€‚
   
   è‡³å°‘éœ€è¦å®ç°ä»¥ä¸‹çš„é€»è¾‘ï¼š
   - åŸºäº LLMs è¾“å‡ºåˆ¤æ–­æ˜¯è°ƒç”¨å·¥å…·è¿˜æ˜¯è¿”å›ç»™ç”¨æˆ·
   - è°ƒç”¨å“ªä¸ªå·¥å…·ï¼Ÿ
   - ä¸ºå·¥å…·è°ƒç”¨å‡†å¤‡è¾“å…¥ï¼Œå¹¶å°†è¾“å‡ºåé¦ˆç»™ LLMs

   LangChain é¢„ç½®äº†å‡ ä¸ª Agent, å…¶ä¸­é»˜è®¤æ˜¯ *zero-shot-react-description*, è¿™æ˜¯åŸºäº [ReAct: Synergizing Reasoning and Acting in Language Models][_react_paper] è®ºæ–‡çš„æ–¹æ³•ã€‚å’±ä»¬åé¢å†çœ‹ã€‚

ç»™äº†ä¸€ä¸ªåŸºäºç”¨æˆ· Queryï¼Œå†…éƒ¨å…ˆåšæœç´¢ã€å†è°ƒç”¨è®¡ç®—å™¨ã€æœ€åè¿”å›è‡ªç„¶è¯­è¨€ç»“æœçš„ä¾‹å­ã€‚
è¿™ä¸ªä¾‹å­å¾ˆæ£’ï¼ŒåŸºæœ¬å’Œ LaMDA è®ºæ–‡é‡Œçš„åŠŸèƒ½ç±»ä¼¼äº†ã€‚æˆ‘ä»¬ä»”ç»†çœ‹ä¸‹è¿è¡Œè¿‡ç¨‹ï¼š

- ç”¨æˆ·è¾“å…¥ï¼š *Who is Olivia Wilde's boyfriend? What is his current age raised to the 0.23 power?*
  
  è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å…ˆæ‰¾åˆ°è¿™ä¸ªäººçš„ bfï¼Œå†æ‰¾ bf çš„å¹´çºªã€‚æœ€åå†ç®—ä¸€ä¸‹å¹‚å€¼ã€‚è¿™ä¸ªé—®é¢˜æœ‰ç‚¹åˆ»æ„äº†ï¼Œä¸è¿‡ä½œä¸ºç¤ºä¾‹ä¹Ÿè¿˜è¡Œã€‚

- Agent åˆ†æè¾“å…¥ï¼Œ ç¡®å®šæ­¥éª¤ï¼š
  
  ```
  Entering new AgentExecutor chain...
  I need to find out who Olivia Wilde's boyfriend is and then calculate his age raised to the 0.23 power.
  ```

- è¿ç»­æ‰¾äººã€æ‰¾å¹´é¾„
  
  ```
  Action: Search
  Action Input: "Olivia Wilde boyfriend"
  Observation: Jason Sudeikis
  Thought: I need to find out Jason Sudeikis' age
  Action: Search
  Action Input: "Jason Sudeikis age"
  Observation: 47 years
  ```

  è¿™é‡Œé¢çš„ Thought æŒºæœ‰æ„æ€ï¼›è¾“å…¥ã€è¾“å‡ºçš„è§£æä¹Ÿå¾ˆå…³é”®ã€‚

- è®¡ç®—å¹‚
  
  ```
  Thought: I need to calculate 47 raised to the 0.23 power
  Action: Calculator
  Action Input: 47^0.23
  Observation: Answer: 2.4242784855673896
  ```
  
  è°ƒç”¨äº†è®¡ç®—å™¨ï¼Œç®—å‡ºç»“æœ

- ç”Ÿæˆæœ€ç»ˆç»“æœï¼Œè¿”å›

  ```plain
  Thought: I now know the final answer
  Final Answer: Jason Sudeikis, Olivia Wilde's boyfriend, is 47 years old and his age raised to the 0.23 power is 2.4242784855673896.
  ```

çœ‹å®Œè¿™ä¸ªæµç¨‹ï¼Œè§‰å¾—çœŸç‰›å•Šâ€¦â€¦

### è®°å½•å†å²ä¿¡æ¯ï¼š Memory

å¦‚æœæœåŠ¡æ˜¯æœ‰çŠ¶æ€çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ª Memory æ¥è®°å½•å†å²çš„ä¿¡æ¯ã€‚è¿™é‡Œæ˜¯ç”¨ Chatbot ä»»åŠ¡æ¥ä¸¾ä¾‹çš„ï¼š
ä¸€èˆ¬åœ°ï¼Œæ–°çš„å¯¹è¯ä¾èµ–å‰é¢çš„å¯¹è¯å†…å®¹ï¼Œå³ *short-term memory*ï¼›
ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¦‚â€œä½ è¿˜è®°å¾—å¤§æ˜æ¹–ç•”çš„å¤é›¨è·å—ï¼Ÿâ€ï¼‰ï¼Œè¿˜éœ€è¦å¾ˆä¹…ä¹‹å‰ä¿¡æ¯æ¥ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œå³ *long-term memory*.

LangChain åœ¨è¿™é‡Œæ²¡æœ‰ç›´æ¥æš´éœ² Memory æ¥å£ï¼Œè€Œæ˜¯ä½¿ç”¨äº†åŒ…å«è®°å¿†çš„ *ConversationChain* æ¥åšä¾‹å­ã€‚
ä»ä¾‹å­é‡Œçœ‹åˆ°ï¼ŒLLMs æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œ
é€šè¿‡å°† memory è®°å½•çš„å†å²æ•°æ®($\\{\rm{user\mbox{-}input}, \rm{LLM\mbox{-}response}\\} \times T$)
å¡«å……è¿› prompts æ¥è®©æ•´ä¸ªå¯¹è¯çœ‹èµ·æ¥æœ‰çŠ¶æ€ã€‚
è¿™å—å…¶å®è¿˜æ˜¯æŒºä½æ•ˆçš„ï¼ˆä¸çŸ¥é“ LLMs å†…éƒ¨æ˜¯å¦æœ‰åšç¼“å­˜ï¼ŒæŒ‰ç…§ä»¥å‰çš„ç»éªŒï¼Œåœ¨ä¸€å¥è¯è§£ç æ—¶è‚¯å®šæ˜¯ç”¨äº†ç¼“å­˜çš„ï¼Œ
ä½†è¿™ç§æ¨¡å‹ä¹‹å¤–è¿ç»­å¢é‡è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œä¸çŸ¥æ˜¯å¦æœ‰ç¼“å­˜ï¼‰ã€‚

[_repo]: https://github.com/hwchase17/langchain "LangChain Github repo"
[_parrot]: https://emojis.wiki/parrot/ "parrot emogis wiki"
[_notion_qa]: https://github.com/hwchase17/notion-qa "notion qa"
[_chat_langchain]: https://github.com/hwchase17/chat-langchain "chat langchain"
[_gpt_wolframalpha]: https://huggingface.co/spaces/JavaFXpert/Chat-GPT-LangChain "Chat-GPT-LangChain"
[_wolfram]: https://www.wolframalpha.com/ "Wolfram Alpha"
[_quickstart]: https://langchain.readthedocs.io/en/latest/getting_started/getting_started.html
[_react_paper]: https://arxiv.org/abs/2210.03629 