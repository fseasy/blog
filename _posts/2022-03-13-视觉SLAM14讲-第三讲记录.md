---
layout: post
title: 视觉SLAM十四讲-第三讲《三维空间刚体运动》阅读笔记
date: 2022-03-18
categories: 技术 
tags: 视觉SLAM十四讲 SLAM
---
> 这章看着好多线代的知识，得补一下。

1. 向量和加减法、内外积，即使坐标系不同，其结果也是一致的。（运算结果与坐标系无关——当然，数值表示时与坐标系有关,
    毕竟表示时就使用了坐标系的基底）

2. 刚体 **旋转矩阵 + 平移向量**，合并到一起，是 **变换矩阵**（位置向量变为四维向量，称为**齐次坐标**）

3. 实战 Eigen 1 : 基础类型
    
    1. `Matrix3d` 中的 `3d` 不是表示3维矩阵，而是表示 `3 x 3 double`, 对应的还有 `Matrix3f`, 
    `Matrix3i` 等 （分别表示 `float`、 `int`）.

       `Matrix3d`, `Vector3f`, `RowVector3f` 等都是 `Matrix<scalar, N1, N2>` 的宏定义。 

    2. `Eigen::Matrix` 什么时候用动态size（`MatrixX*`），什么时候用静态size（模板参数）?

        显然，如果是运行时才知道，那必然只能用动态size；

        其次，根据[文档][1]：
        
        - 矩阵规模小（一般小于等于16），最好用静态的，这样变量都站栈上，快；
        
        - 矩阵规模大了（大于32），那也建议用动态的（如可用 `MatrixXd(row, col)` 初始化），因为
        这时用静态的，可能会爆栈。

        > 可知，模板定义的静态参数，是永远在栈上申请的。

    3. 似乎老版本(`3.4`前)，不支持用 `initializer list` 初始化矩阵

        看 [文档][1] 支持使用 initializer list 来做初始化，然而我编译总是报错。

        ```bash
        error: no matching function for call to 
        ‘Eigen::Matrix<int, -1, -1>::Matrix(<brace-enclosed initializer list>)’
        ```
        
        开始以为是CMake没有设置好 `-std=c++11`, 折腾半天还是不行。 search网上，信息好少，找到一个
        [C++ initializer lists for arbitrary length vectors](https://gitlab.com/libeigen/eigen/-/issues/2137)
        看起来说`3.3.9` 还不行；我看了下ubuntu直接装的Eigen3版本，在 
        */usr/include/eigen3/Eigen/src/Core/util/Macros.h*
        下，是 `3.3.7`, 果然不行啊…… 白折腾了。

        > 又去找了下change log, 也没发现有这个改动； 文档里也没有说从什么版本开始支持的…… 一个字，有点坑啊  
        并没有试最新版是否支持——算了，别总在这种细节地方折腾 = =； 老实用comma初始化，不一样吗？ 还少写几个括号呢！

4. 欧拉角的万向锁问题(Gimbal Lock)

    本质原因，应该还是： **没法用三个变量不带奇异性的表示三维空间内的旋转**，正如
    用经纬度两个坐标表示铺开的地球平面，在维度为90度时，经度无唯一解：任意经度，在维度=90时，
    其实都对应到3维球面的一个点，故是奇异性的。
    这个就和万向锁一样：当pitch = 90度时，改变X、Z都无法让物体离开某一个平面；
    即在一个位置，X、Z不能有唯一解。

    > 看到网上说法，万向锁存在的前提，是使用动态欧拉角。即每次变换，都基于变换后的坐标系。

5. 描述三维空间中的刚体运动（欧式变换），为何要有多种表达： 
旋转矩阵+平移向量 $\rightarrow$ 变换矩阵+齐次坐标 
$\rightarrow$ 旋转向量+欧拉角 $\rightarrow$ 四元数

    两个坐标系变换，最直观的计算，就是旋转矩阵+平移向量（描述刚体运动）。

    变换矩阵+齐次坐标，是为了解决旋转矩阵+平移向量书写繁琐的问题。没有本质区别，不过表示上的trick。

    旋转向量+欧拉角，针对的是

    1. 变换矩阵16个(旋转矩阵+平移向量同样16个)表示3个自由度的旋转，显得冗余
    
    2. 旋转矩阵本身有约束（正交矩阵、行列式为1；变换矩阵也有约束）。在求解此矩阵时，很难计算
       （带约束求解）
    
    3. 矩阵表示不够直观，人看不明白究竟怎么旋转的

    这几个问题。但又有万向锁问题……

    四元数(`Quanternions`)是用来解决欧拉角问题的：4个变量表示3维旋转；表达准确，不存在奇异性；

    > 在[四元数——基本概念][2]中，说到四元数（相比欧拉角）的优点和应用：“解决万向节死锁（Gimbal Lock）问题，
    仅需存储4个浮点数，相比矩阵更加轻量，四元数无论是求逆、串联等操作，相比矩阵更加高效；
    现在主流游戏或动画引擎都会以缩放向量+旋转四元数+平移向量的形式进行存储角色的运动数据。”
    可以看到，四元数，只是描述了旋转，不含平移。

    > 这本书这里讲得还是有点难的，学习曲线陡增…… 先混过去

    > 旋转3个自由度，平移还有3个自由度；所以欧式变换，一个6个自由度。书里比较强调旋转，有时忽略了平移。

6. 3维空间的更多变换方式： 相似变换、仿射变换、射影变换。

    欧式，相似，仿射，射影，依次变得一般性。射影变换就对应到现实世界到相片的变换。



[1]: https://eigen.tuxfamily.org/dox/group__TutorialMatrixClass.html
[2]: https://zhuanlan.zhihu.com/p/27471300